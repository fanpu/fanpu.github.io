
\begin{aligned} 
    q_m^{\top} k_n & =\left(W_q\left(x_m+p_m\right)\right)^{\top}\left(W_k\left(x_n+p_n\right)\right) \\ & =x_m^{\top} W_q^{\top} W_k x_n+x_m^{\top} w_q^{\top} W_k p_n \\ & +p_m^{\top} w_q^{\top} W_k x_n+p_m^{\top} W_q^{\top} W_k p_n
\end{aligned}